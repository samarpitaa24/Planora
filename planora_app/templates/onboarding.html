<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Planora - Setup Your Profile</title>
   <link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/onboarding.css') }}"
/>
</head>
<body>
    <div class="onboarding-container">
        <div class="header">
            <h1>Planora</h1>
            <p>Help us to know you better</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-dots" id="progressDots"></div>
        </div>

        <!-- Alert Messages -->
        <div class="alert alert-danger" id="errorAlert"></div>

        <form method="POST" action="{{ url_for('onboarding.onboarding') }}" id="onboardingForm">

            <!-- Step 1: Age -->
            <div class="step active" data-step="1">
                <div class="question-container">
                    <h2 class="question-title">What's your age?</h2>
                    <div class="input-container">
                        <label class="question-label">Age</label>
                        <input type="number" id="age" name="age" min="18" max="30" placeholder="Enter your age" required>
                    </div>
                </div>
                <div class="nav-buttons">
                    <div></div>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 2: Date of Birth -->
            <div class="step" data-step="2">
                <div class="question-container">
                    <h2 class="question-title">What's your date of birth?</h2>
                    <div class="input-container">
                        <input type="date" id="dob" name="dob" max="{{ max_date }}" required>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 3: Subjects -->
            <div class="step" data-step="3">
                <div class="question-container">
                    <h2 class="question-title">Which subjects do you study?</h2>
                    <p class="question-label">(Select all that apply)</p>
                    <div class="checkbox-grid">
                        <label class="checkbox-card">
                            <input type="checkbox" name="subjects" value="Math">
                            <div class="checkmark"></div>
                            <div class="card-content">Math</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="subjects" value="Physics">
                            <div class="checkmark"></div>
                            <div class="card-content">Physics</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="subjects" value="Chemistry">
                            <div class="checkmark"></div>
                            <div class="card-content">Chemistry</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="subjects" value="Biology">
                            <div class="checkmark"></div>
                            <div class="card-content">Biology</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="subjects" value="English">
                            <div class="checkmark"></div>
                            <div class="card-content">English</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="subjects" value="History">
                            <div class="checkmark"></div>
                            <div class="card-content">History</div>
                        </label>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 4: Sleep Schedule -->
            <div class="step" data-step="4">
                <div class="question-container">
                    <h2 class="question-title">What's your sleep schedule?</h2>
                    <div class="input-container">
                        <select id="sleep_schedule" name="sleep_schedule" required>
                            <option value="">Select your sleep pattern</option>
                            <option value="Early bird">Early bird</option>
                            <option value="Night owl">Night owl</option>
                            <option value="Flexible">Flexible</option>
                        </select>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 5: Morning/Evening Person -->
            <div class="step" data-step="5">
                <div class="question-container">
                    <h2 class="question-title">When do you study best?</h2>
                    <div class="input-container">
                        <select id="morning_evening_person" name="morning_evening_person" required>
                            <option value="">Select your preference</option>
                            <option value="Morning">Morning</option>
                            <option value="Evening">Evening</option>
                            <option value="Both">Both</option>
                        </select>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 6: Motivation -->
            <div class="step" data-step="6">
                <div class="question-container">
                    <h2 class="question-title">What motivates you to study?</h2>
                    <div class="input-container">
                        <select id="motivation" name="motivation" required>
                            <option value="">Select your motivation</option>
                            <option value="Grades">Grades</option>
                            <option value="Knowledge">Knowledge</option>
                            <option value="Competition">Competition</option>
                            <option value="Routine">Routine</option>
                        </select>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 7: Difficulties -->
            <div class="step" data-step="7">
                <div class="question-container">
                    <h2 class="question-title">What makes studying difficult for you?</h2>
                    <p class="question-label">(Select all that apply)</p>
                    <div class="checkbox-grid">
                        <label class="checkbox-card">
                            <input type="checkbox" name="difficulties" value="Procrastination">
                            <div class="checkmark"></div>
                            <div class="card-content">Procrastination</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="difficulties" value="Distractions">
                            <div class="checkmark"></div>
                            <div class="card-content">Distractions</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="difficulties" value="Lack of interest">
                            <div class="checkmark"></div>
                            <div class="card-content">Lack of interest</div>
                        </label>
                        <label class="checkbox-card">
                            <input type="checkbox" name="difficulties" value="Fatigue">
                            <div class="checkmark"></div>
                            <div class="card-content">Fatigue</div>
                        </label>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 8: Preferred Study Time -->
            <div class="step" data-step="8">
                <div class="question-container">
                    <h2 class="question-title">What's your preferred study time?</h2>
                    <p class="question-label">Set your ideal study time window (maximum 3 hours)</p>
                    <div class="input-container">
                        <div class="time-inputs">
                            <div class="time-input-group">
                                <label for="study_start">Start Time:</label>
                                <input type="time" id="study_start" name="study_start" required>
                            </div>
                            <div class="time-input-group">
                                <label for="study_end">End Time:</label>
                                <input type="time" id="study_end" name="study_end" required>
                            </div>
                        </div>
                        <div class="duration-info" id="durationInfo">Select times to see duration</div>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button type="button" class="btn btn-back" onclick="prevStep()">Back</button>
                    <button type="submit" class="btn btn-submit">COMPLETE SETUP</button>
                </div>
            </div>

        </form>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 8;

        // Initialize progress dots
        function initProgressDots() {
            const dotsContainer = document.getElementById('progressDots');
            dotsContainer.innerHTML = '';
            for (let i = 1; i <= totalSteps; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (i === 1) dot.classList.add('active');
                dotsContainer.appendChild(dot);
            }
        }

        // Update progress bar
        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const dots = document.querySelectorAll('.progress-dot');
            
            const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            progressFill.style.width = progressPercentage + '%';
            
            dots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    dot.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    dot.classList.add('active');
                }
            });
        }

        // Show error message
        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            errorAlert.textContent = message;
            errorAlert.classList.add('show');
            setTimeout(() => {
                errorAlert.classList.remove('show');
            }, 3000);
        }

        // Calculate time duration
        function calculateDuration() {
            const startInput = document.getElementById('study_start');
            const endInput = document.getElementById('study_end');
            const durationInfo = document.getElementById('durationInfo');

            if (startInput.value && endInput.value) {
                const start = new Date(`1970-01-01T${startInput.value}:00`);
                let end = new Date(`1970-01-01T${endInput.value}:00`);
                
                // Handle cases where end time is past midnight
                if (end <= start) {
                    end.setDate(end.getDate() + 1);
                }
                
                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);
                const hours = Math.floor(diffHours);
                const minutes = Math.round((diffHours - hours) * 60);
                
                if (diffHours > 3) {
                    durationInfo.style.color = '#c33';
                    durationInfo.textContent = `Duration: ${hours}h ${minutes}m (exceeds 3 hour limit)`;
                } else {
                    durationInfo.style.color = '#667eea';
                    durationInfo.textContent = `Duration: ${hours}h ${minutes}m`;
                }
            }
        }

        // Add event listeners for time inputs
        document.getElementById('study_start')?.addEventListener('change', calculateDuration);
        document.getElementById('study_end')?.addEventListener('change', calculateDuration);

        // Validation per step
        function validateStep() {
            if (currentStep === 1) {
                const age = document.getElementById('age').value;
                if (!age || age < 18 || age > 30) {
                    showError('Age must be between 18 and 30');
                    return false;
                }
            }

            if (currentStep === 2) {
                const dob = document.getElementById('dob').value;
                if (!dob) {
                    showError('Please select your date of birth');
                    return false;
                }
            }

            if (currentStep === 3) {
                const subjects = document.querySelectorAll('input[name="subjects"]:checked');
                if (subjects.length === 0) {
                    showError('Please select at least one subject');
                    return false;
                }
            }

            if (currentStep === 4) {
                const sleepSchedule = document.getElementById('sleep_schedule').value;
                if (!sleepSchedule) {
                    showError('Please select your sleep schedule');
                    return false;
                }
            }

            if (currentStep === 5) {
                const studyTime = document.getElementById('morning_evening_person').value;
                if (!studyTime) {
                    showError('Please select when you study best');
                    return false;
                }
            }

            if (currentStep === 6) {
                const motivation = document.getElementById('motivation').value;
                if (!motivation) {
                    showError('Please select your motivation');
                    return false;
                }
            }

            if (currentStep === 7) {
                const difficulties = document.querySelectorAll('input[name="difficulties"]:checked');
                if (difficulties.length === 0) {
                    showError('Please select at least one difficulty');
                    return false;
                }
            }

            if (currentStep === 8) {
                const start = document.getElementById('study_start').value;
                const end = document.getElementById('study_end').value;

                if (!start || !end) {
                    showError('Please select both start and end times');
                    return false;
                }

                const startDt = new Date(`1970-01-01T${start}:00`);
                let endDt = new Date(`1970-01-01T${end}:00`);
                if (endDt <= startDt) endDt.setDate(endDt.getDate() + 1);

                const hoursDiff = (endDt - startDt) / (1000 * 60 * 60);
                if (hoursDiff > 3) {
                    showError('Preferred study time cannot exceed 3 hours');
                    return false;
                }
            }

            return true;
        }

        // Go to next step
        function nextStep() {
            if (!validateStep()) return;

            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            currentStep++;
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Go back to previous step
        function prevStep() {
            if (currentStep === 1) return;

            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            currentStep--;
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize on page load
        initProgressDots();
        updateProgress();
    </script>
</body>
</html>